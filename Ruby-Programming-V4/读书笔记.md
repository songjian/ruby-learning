# Ruby基础教程v4

## 第5章 条件判断

### ruby的三种主要条件判断语句
* if
* unless
* case

### Ruby真假值
|真|假|
|--|--|
|真|false、nil以外的所有对象|
|假|false、nil|

#### if语句

```ruby
if 条件 then
end
```

then 可以省略

#### unless语句

条件为假时执行

```ruby
unless 条件 then
end
```
then 可以省略

#### case语句

```ruby
case 比较对象
when 值1 then
  处理1
when 值2 then
  处理2
when 值3 then
  处理3
else
  处理4
end
```

then 可以省略

### === 与 case
在case语句中，when判断值是否相等时，实际是使用===运算符来判断。左边是数值或字符串时，===与==意义一样，除此之外，===还可以与=~一样用来判断正则表达式是否匹配，或者判断右边的对象是否属于左边的类，等等。对比单纯的判断两边的值是否相等，===能表达更加广义的"相等"。

### eql? 判断值相等比 == 严谨
例如：0 与 0.0 和 1.0 与 1 eql? 返回 false  ==返回 true

## 第6章 循环

### 实现循环的方法

* times 方法
* while 语句
* each 方法
* for 语句
* until 语句
* loop 方法

#### times方法

```ruby
# 满地油菜花输出7遍
7.times do
  puts "满地油菜花"
end
```

得到当前的循环次数
```ruby
10.times do |i|
  puts i
end
```

#### for语句

for语句与times方法不一样，循环的开始值和结束值可以任意指定。

```ruby
sum = 0
for i in 1..5 do
  sum = sum + i
end
puts sum
```
do可以省略

计算变量from到变量to累加的总数
```ruby
from = 10
to = 20
sum = 0
for i in from..to
  sum = sum + i
end
puts sum
```

#### 普通for语句

```ruby
names = ["awk", "Perl", "Python", "Ruby"]
for name in names
  puts name
end
```

#### while语句

```ruby
i = 1
while i < 3
  puts i
  i += 1
end
```
#### until语句

until语句的结构与white完全一样，只是条件判断刚好相反，不满足条件时才执行循环处理

#### each方法

each方法将对象集合里的对象逐条取出

```ruby
names = ["awk", "Perl", "Python", "Ruby"]
names.each do |name|
  puts name
end
```

```ruby
sum = 0
(1..5).each do |i|
  sum = sum + i
end
puts sum
```

#### loop方法

loop方法没有终止条件，只是不断的执行循环

### 循环控制

* break 终止程序，跳出循环
* next 跳到下一次循环
* redo 在相同的条件下重复刚才的处理

#### break

break会终止全体循环程序

#### next

next会忽略next后面的部分，跳到下一个循环开始的部分

#### redo

redo和next非常像，与next不同之处是，redo会再执行一次相同的循环
break和next比较常用，redo在ruby默认提供的程序库里也很难找到踪影

### do ~ end 与 { ~ }

一般的约定

* 程序是跨行写的时候使用 do ~ end
* 程序写在1行的时候用 { ~}

## 第7章 方法

### 方法调用

```ruby
对象.方法名(参数1, 参数2, … ,参数n)
```

对象被称为接收者(receiver)。在面向对象的世界中，调用方法被称为『向对象发送消息（message）』，调用的结果就是『对象接收(receive)了消息』，也就是说，方法的调用就是把几个参数连同消息一起发送给对象的过程。

### 带块的方法调用

each 和 loop 等方法都属于带块的方法

使用do ~ end是，可以省略参数列表括起来的()。使用{~}时，只有在没有参数的时候才可以省略()。

### 运算符形式的方法调用

Ruby中有些方法看起来很像运算符。四则运算等的二元运算符、-（负号）等的一元运算符、指定数组、散列的元素下标的[]等，实际都是方法。

* obj + arg1
* obj =~ arg1
* -obj
* !obj
* obj[arg1]
* obj[arg1] = arg2

实际上可以将obj理解为接收者，将arg1、arg2理解为参数。

### 方法的分类

Ruby的方法分为3类：
* 实例方法
* 类方法
* 函数式方法

#### 实例方法

如果有一个对象的实例，那么以这个对象为接收者的方法就是实例方法。

```ruby
p "10, 20, 30, 40".split(",")
p [1, 2, 3, 4].index(2)
p 1000.to_s
```

#### 类方法

接收者不是对象而是类本身时的方法，是类方法。

```ruby
Array.new
File.open("some_file")
Time.now
```

调用类方法时，可以使用::代替.。Ruby语法中 :: 和 . 代表的意思是一样的。

#### 函数式方法

没有接收者的方法是函数式方法。

```ruby
print "hello!"
sleep(10)
```

函数式方法的执行结果，不会根据接收者的状态而发生变化。程序运行print方法以及sleep方法的时候，不需要知道接收者是谁。反过来说，不需要接收者的方法就是函数式方法。

#### Ruby帮助文档里实例方法的标记法

Ruby帮助文档里标记类的实例方法用Array#each、Array#inject写法。

### 方法的定义

定义方法的一般语法：
```ruby
def 方法名 (参数1， 参数2)
  希望执行的代码
end
```
方法名可以由英文字母、数字、下划线组成，但不能以数字开头。

方法有多个参数时，从参数列表右边开始依次指定默认值。

```ruby
def func(a, b=1, c=3)
end
```

#### 方法的返回值

可以用return指定方法的返回值

可以省略return语句，方法的最后一个表达式的结果作为方法的返回值

return语句可以马上终止程序

#### 定义带块的方法

```ruby
def myloop
  while true
    yield # 执行块
  end
end

num = 1   # 初始化num
myloop do
  puts "num is #{num}"
  break if num > 100     # num超过100时跳出循环
  num * 2
end
```

yield是定义块的关键字

#### 参数个数不确定的方法

通过 『\*变量名』 的形式来定义参数个数不确定的方法

```ruby
def foo(*args)
  args
end

p foo(1, 2, 3)   #=> [1, 2, 3]

def meth(arg, *args)
  [arg, args]
end

p meth(1)         #=> [1, []]
p meth(1, 2, 3)   #=>[1, [2, 3]]
```

#### 关键字参数

Ruby 2.0加入的新特性

```ruby
def 方法名(参数1:值, 参数2:值)
  代码逻辑
end
```

可以使用 『\*\*变量名』这种形式来接收未定义的参数

关键字参数可以与普通参数搭配使用

可以使用散列传递参数
